# vibe-guard-init

Lock your architecture decisions once. Agents enforce them every session.

---

## What it does

`vibe-guard-init` is a zero-dependency bash script that asks you 5 key architecture questions at the start of a project, then writes a locked `## Architecture Lock` block into `CLAUDE.md`. AI agents (Claude, Cursor, etc.) read this block every session and refuse to deviate from the locked choices.

**No more architecture drift.** Once locked, agents won't suggest switching from Zustand to Redux, or adding styled-components to a Tailwind project, or restructuring your feature folders.

---

## The 5 questions

| # | Topic             | Options                                                               |
|---|-------------------|-----------------------------------------------------------------------|
| 1 | Framework         | React, Next.js, Vue, Svelte, vanilla, or custom                      |
| 2 | Styling           | Tailwind CSS, CSS Modules, styled-components, vanilla CSS, none, or custom |
| 3 | State Management  | useState only, Zustand, Redux, Jotai, Context API, none, or custom   |
| 4 | File Structure    | feature-based, type-based, flat, or custom                           |
| 5 | Testing           | Vitest, Jest, Playwright, none, or custom                            |

---

## Usage

### Basic (interactive)

```bash
cd your-project/
./tools/vibe-guard-init.sh
```

The script walks you through the 5 questions, shows a confirmation summary, then writes the Architecture Lock block to `CLAUDE.md`.

### Dry run (preview only)

```bash
./tools/vibe-guard-init.sh --dry-run
```

Prints the block that would be written. Nothing is written to disk. Use this to see exactly what agents will read before committing.

### Updating decisions

Re-run the script:

```bash
./tools/vibe-guard-init.sh
```

If an existing Architecture Lock block is found in `CLAUDE.md`, it is replaced. If not found, the new block is appended.

> âš ï¸ **Update protocol:** Always use `vibe-guard-init` to change decisions. Do not edit the block manually â€” the `<!-- DO NOT MODIFY -->` comment is there for a reason.

---

## Output

### New CLAUDE.md (created from scratch)

If `CLAUDE.md` doesn't exist, the script creates one with a standard header and the Architecture Lock block:

```markdown
# CLAUDE.md

This file is read by AI agents every session. It contains project-specific rules and context.

---

<!-- DO NOT MODIFY â€” generated by vibe-guard-init on 2026-01-15 10:30 EST -->
## Architecture Lock

> âš ï¸ These decisions are locked. Agents must enforce them every session.
> To change architecture decisions, re-run `vibe-guard-init`. Do not edit this block manually.

### Locked Decisions

| Decision         | Choice                         |
|------------------|-------------------------------|
| Framework        | React                         |
| Styling          | Tailwind CSS                  |
| State Management | Zustand                       |
| File Structure   | feature-based (group by feature) |
| Testing          | Vitest                        |

### Agent Rules
...

<!-- END ARCHITECTURE LOCK -->
```

### Appending to existing CLAUDE.md

If `CLAUDE.md` already exists (and has no prior Architecture Lock), the block is appended after a `---` separator.

### Replacing an existing lock

If `CLAUDE.md` already contains an Architecture Lock block, it's replaced in-place. The rest of `CLAUDE.md` is untouched.

---

## Examples

### React + Tailwind + Zustand project

```
$ ./tools/vibe-guard-init.sh

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ”’ vibe-guard-init â€” Architecture Lock        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  Lock your architecture decisions once. Agents enforce them every session.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Framework â€” What UI framework does this project use?
  1. React
  2. Next.js
  ...

  Enter choice [1-6]: 1

2. Styling â€” How is CSS handled in this project?
  1. Tailwind CSS
  ...

  Enter choice [1-6]: 1

3. State Management â€” What state management approach is used?
  ...
  Enter choice [1-7]: 2   â† Zustand

4. File Structure â€” What file/folder convention does this project follow?
  ...
  Enter choice [1-4]: 1   â† feature-based

5. Testing â€” What testing approach does this project use?
  ...
  Enter choice [1-5]: 1   â† Vitest

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Architecture decisions locked:
  Framework:       React
  Styling:         Tailwind CSS
  State mgmt:      Zustand
  File structure:  feature-based (group by feature)
  Testing:         Vitest

  Write this to CLAUDE.md? [Y/n]: Y

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  âœ… Architecture Lock written to CLAUDE.md

  File: /home/user/my-app/CLAUDE.md
  Time: 2026-01-15 10:30 EST
```

### Next.js + CSS Modules + no state + no tests

Run the script and select:
- Framework â†’ `2` (Next.js)
- Styling â†’ `2` (CSS Modules)
- State Management â†’ `6` (none)
- File Structure â†’ `2` (type-based)
- Testing â†’ `4` (none)

See [`tests/vibe-guard-init/fixture-nextjs-cssmodules-none.md`](../tests/vibe-guard-init/fixture-nextjs-cssmodules-none.md) for the exact output this produces.

---

## Test fixtures

Two reference outputs live in `tests/vibe-guard-init/`:

| File | Combo |
|------|-------|
| `fixture-react-tailwind-zustand.md` | React + Tailwind CSS + Zustand + feature-based + Vitest |
| `fixture-nextjs-cssmodules-none.md` | Next.js + CSS Modules + none + type-based + none |

These are used for regression testing and as references for what the locked block looks like.

---

## How agents use the lock

When Claude (or any AI agent) reads `CLAUDE.md` at session start and encounters the Architecture Lock block, it must:

1. Recognize the `## Architecture Lock` section as authoritative project config
2. Refuse requests that contradict locked decisions (e.g., "add Redux" when Zustand is locked)
3. Explain the lock to the user when refusing
4. Flag potential issues (e.g., "you're asking me to add styled-components, but CSS Modules is locked â€” let me know if you want to re-run vibe-guard-init")

The locked block is intentionally verbose so there's no ambiguity about what's expected.

---

## Design philosophy

- **Zero dependencies** â€” pure bash, works on Linux, macOS, and WSL
- **Dead simple** â€” interactive prompts, no config files, no YAML, no JSON
- **Obvious output** â€” the generated block is human-readable and self-explanatory
- **Escape hatch built in** â€” the update protocol is documented in the block itself
- **Non-destructive** â€” never overwrites unrelated content in `CLAUDE.md`

---

## Requirements

- bash 4.0+ (macOS ships with 3.x â€” use `brew install bash` if needed, or run via `bash ./tools/vibe-guard-init.sh`)
- python3 (for replace-in-place when updating an existing lock â€” standard on modern systems)
- No other dependencies

---

## License

MIT. Do whatever you want with these.

## About

Made by [@BChopLXXXII](https://x.com/BChopLXXXII)

Built for vibe coders who want to ship fast without the spaghetti.

Ship it. ğŸš€

---

If this helped, [star the repo](https://github.com/BChopLXXXII/vibe-coder-rules) â€” it helps others find it.
